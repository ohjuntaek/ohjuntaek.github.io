---
layout: post
title: Kotlin Spring Data Rest Swagger
category: coding
---

ì½”í‹€ë¦° ìŠ¤í”„ë§ê³¼ spring-data-rest, swagger2ë¥¼ ì´ìš©í•´ rest apië¥¼ ë§Œë“¤ê³  ë¬¸ì„œí™” í•œ ê³¼ì •ì—ì„œ ì‚½ì§ˆí•œ ê²½í—˜ì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤.

[ì™„ì„±ë³¸ ê¹ƒí—ˆë¸Œ ë§í¬](https://github.com/ohjuntaek/blog-repo/tree/master/demo)

## 1. Kotlin Springì—ì„œ Rest API ê°„ë‹¨íˆ ì‚¬ìš©

IntelliJì˜ spring initializerë¥¼ í†µí•´ ì½”í‹€ë¦° ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ê³ , data-rest repository, hal-browser, h2ë¥¼ ì‚¬ìš©í•´ ë¡œì»¬ì—ì„œ rest apië¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

ì‚¬ìš©í•œ ì˜ì¡´ì„±
```
implementation("org.springframework.boot:spring-boot-starter-data-jpa")
implementation("org.springframework.boot:spring-boot-starter-data-rest")
implementation("org.springframework.boot:spring-boot-starter-web")
implementation("org.springframework.data:spring-data-rest-hal-browser")
```

ì‘ì„±í•œ ì½”ë“œ

```kotlin

@Entity
data class Plan(
        @Id
        @GeneratedValue(strategy = GenerationType.AUTO)
        var id: Long? = null,
        var title : String? = null,
        var content : String? = null,
        var startTime : LocalDateTime? = null,
        var endTime : LocalDateTime? = null
)

@Repository
interface PlanRepository : JpaRepository<Plan, Long> {
}

```

ì´ë ‡ê²Œ ê°„ë‹¨íˆ planì— ëŒ€í•œ crud apië¥¼ ë§Œë“¤ë ¤ í–ˆì§€ë§Œ...

```
spring data rest  error creating bean with name 'repositoryController' defined in URL ....
```

ë¼ëŠ” ë¹ˆ ìƒì„± ì˜¤ë¥˜ê°€ ê³„ì† ìƒê²¨ì„œ í•œì°¸ í—¤ë§¸ë„¤ìš”. ì¸í…”ë¦¬ì œì´ì—ì„œ ë­”ê°€ ëˆ„ë¥´ë‹¤ ë³´ë‹ˆ ì½”í‹€ë¦° ìŠ¤í”„ë§ì„ ìë°” ìŠ¤í”„ë§ìœ¼ë¡œ ë³€í™˜í–ˆì—ˆëŠ”ì§€ Application.ktì˜ ì½”ë“œê°€ ìë°” ìŠ¤í”„ë§ í˜•ì‹ìœ¼ë¡œ ë°”ë€Œì–´ ìˆì—ˆìŠµë‹ˆë‹¤.  
í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ë˜‘ê°™ì´ í•˜ë‹ˆê¹ í•´ê²° ëë„¤ìš”ğŸ˜¢

ê²°ê³¼ í™”ë©´  
![ìƒì„±ëœ hal-broswer](https://github.com/ohjuntaek/ohjuntaek.github.io/blob/master/_posts/resources/200310_hal_browser.PNG?raw=true)

apië¥¼ ë§Œë“¤ê³  ë¬¸ì„œí™”ê¹Œì§€ í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

## 2. swagger2 ê°„ë‹¨íˆ ì ìš©

[Swagger ê³µì‹ ë¬¸ì„œ](https://springfox.github.io/springfox/docs/current/)

[Swagger ì ìš©-baeldung](https://www.baeldung.com/swagger-2-documentation-for-spring-rest-api)

ì´ ì™¸ì— ë§ì€ ìë£Œë“¤ì„ ë´¤ì§€ë§Œ, ì´ ë‘ ìë£Œê°€ ê°€ì¥ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.

ê°„ë‹¨í•œ ì‘ì—…ì´ì§€ë§Œ ì€ê·¼íˆ í˜ë“  ë¶€ë¶„ì´ ë§ì•˜ë„¤ìš”.

### ì´ìŠˆ 1. ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ ì—…ê·¸ë ˆì´ë“œì— ë”°ë¥¸ ì´ìŠˆ

https://stackoverflow.com/questions/58626347/springfox-swagger-not-working-in-spring-boot-2-2-0

í”„ë¡œì íŠ¸ì—ì„œ ìŠ¤í”„ë§ ë¶€íŠ¸ 2.2.5ë¥¼ ì‚¬ìš©í–ˆëŠ”ë° ìŠ¤ì›¨ê±° ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” ìµœì‹  ë¦´ë¦¬ì¦ˆì¸ 2.9.2ì—ëŠ” ì•„ì§ ë­”ê°€ ë¬¸ì œê°€ ìˆë‚˜ ë³´ë”ë¼ê³ ìš”. 3.0.0-SNAPSHOTì„ ì‚¬ìš©í•˜ë‹ˆ í•´ê²°ëìŠµë‹ˆë‹¤.

### ì´ìŠˆ 2. Unable to infer base url

https://stackoverflow.com/questions/47425048/why-does-springfox-swagger2-ui-tell-me-unable-to-infer-base-url

3.0.0-SNAPSHOTìœ¼ë¡œ ë°”ê¾¸ê³  @EnableSwagger2WebMvcë¡œ ë°”ê¿¨ëŠ”ë° ìœ„ì˜ ì´ìŠˆê°€ ë°œìƒí–ˆëŠ”ë°, springfox-webmvc ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ë‹ˆ ê°„ë‹¨íˆ í•´ê²°ëìŠµë‹ˆë‹¤.

ìœ„ì˜ ì´ìŠˆë¥¼ í•´ê²°í•œ í›„ spring-data-restì— í•´ë‹¹í•˜ëŠ” springfox-data-rest ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ì—¬ ì‘ì—…ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

> (1) snapshotê³¼ realaseì— ëŒ€í•œ ì°¨ì´ì˜ ì´í•´
[SW ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´í•´](https://futurecreator.github.io/2018/09/09/software-versioning/)  
> (2) gradle dslì— ëŒ€í•œ ì§€ì‹ (kotlin gradle dsl)
[Gradle Kotlin Dsl ê´€ë ¨ ì •ë³´](https://woowabros.github.io/tools/2019/04/30/gradle-kotlin-dsl.html)  
>
> ìœ„ì˜ ë‘ê°€ì§€ ê°œë…ì„ ëª°ëê¸° ë•Œë¬¸ì— í•´ê²°í•˜ëŠ”ë° ì‹œê°„ì´ ì—„ì²­ ì˜¤ë˜ ê±¸ë ¸ë„¤ìš”. 

ì¶”ê°€ëœ ì˜ì¡´ì„±ë“¤

```kotlin
repositories {
    mavenCentral()
    maven("http://oss.jfrog.org/artifactory/oss-snapshot-local/") // ì´ ë¶€ë¶„ì—ì„œ maven repoë¥¼ ì¶”ê°€í•˜ëŠ” ë¬¸ë²•ì„ ëª°ë¼ì„œ í•œì°¸ í•´ë§¸ìŠµë‹ˆë‹¤.
}
dependencies {
    ... 
    // Swagger (API Document)
    implementation("io.springfox:springfox-swagger2:3.0.0-SNAPSHOT")
    implementation("io.springfox:springfox-swagger-ui:3.0.0-SNAPSHOT")
    implementation("io.springfox:springfox-spring-webmvc:3.0.0-SNAPSHOT") // webmvc
    implementation("io.springfox:springfox-data-rest:3.0.0-SNAPSHOT")
    ...
}
```

ìŠ¤ì›¨ê±° ì„¤ì • ì½”ë“œ

```kotlin
@Configuration
@EnableSwagger2WebMvc
@Import(SpringDataRestConfiguration::class)
class SwaggerConfig {
    @Bean
    fun planApi(): Docket {
        return Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.any())
                .paths(PathSelectors.any())
                .build()
    }
}

```

ê²°ê³¼ í™”ë©´

![Swagger2 UI](https://github.com/ohjuntaek/ohjuntaek.github.io/blob/master/_posts/resources/200310_swagger.PNG?raw=true)

## ì´í‰

- ê°„ë‹¨í•˜ê¸°ëŠ” hal-browserê°€ í›¨ì”¬ ê°„ë‹¨í•˜ê³  ê³µë¶€í•  ê²ƒë„ ì ì—ˆìŠµë‹ˆë‹¤. spring initializerì—ì„œ ì²´í¬ë§Œ í•˜ë©´ ë˜ë‹ˆ ë²„ì „ë³„ ëŒ€ì‘ ë¬¸ì œë„ ì—†ì„ ê²ƒ ê°™ë„¤ìš”.
- í™•ì‹¤íˆ Swaggerê°€ uiê°€ í›¨ì”¬ ì´ì˜ê³  ëˆˆì— ì˜ ë“¤ì–´ì˜¤ê¸´ í•©ë‹ˆë‹¤. ê³µì‹ ë¬¸ì„œ ë³´ë©´ ì„¤ì •í•˜ëŠ” ê²ƒë„ ë§ì•„ë³´ì—¬ì„œ ë” í™•ì¥ì„± ìˆê²Œ ëŠê»´ì§€ê¸´ í–ˆëŠ”ë°... ìµœì‹  ë²„ì „ ëŒ€ì‘í•˜ê¸°ê°€ ë„ˆë¬´ í˜ë“¤ì—ˆë„¤ìš”. ì¥ë‹¨ì ì´ ìˆëŠ”ê±° ê°™ìŠµë‹ˆë‹¤.
- ì—ëŸ¬ ì¡ì„ ë•Œ í•œêµ­ì–´ë¡œ ëœ ìë£Œê°€ ì—†ì–´ì„œ í˜ë“¤ì—ˆë„¤ìš”. í˜¹ì‹œ ì´ê²Œ ë„ì›€ì´ ë  ìˆ˜ë„?
